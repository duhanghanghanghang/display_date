<!-- pages/index/index.wxml -->
<view class="container" bindtouchstart="onTouchStart" bindtouchend="onTouchEnd">
  <!-- æ— å›¢é˜Ÿæç¤º -->
  <view class="no-team" wx:if="{{!hasTeam}}">
    <text>å¦‚éœ€è¦å¤šäººåŒæ­¥ï¼Œè¯·åœ¨â€œå›¢é˜Ÿâ€ä¸­æ“ä½œã€‚</text>
  </view>
  <!-- å¤´éƒ¨ç»Ÿè®¡åŒºåŸŸ -->
  <view class="header-card">
    <view class="stats-row">
      <view class="stat-item" bindtap="onFilterChange" data-type="all">
        <text class="stat-number">{{totalCount}}</text>
        <text class="stat-label">å…¨éƒ¨</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item stat-expired" bindtap="onFilterChange" data-type="expired">
        <text class="stat-number">{{expiredCount}}</text>
        <text class="stat-label">å·²è¿‡æœŸ</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item stat-warning" bindtap="onFilterChange" data-type="warning">
        <text class="stat-number">{{warningCount}}</text>
        <text class="stat-label">å³å°†è¿‡æœŸ</text>
      </view>
    </view>
    <view class="reminder-tip">
      ä¸´æœŸæé†’ï¼šåˆ°æœŸå‰{{reminderDays}}å¤©æç¤º
    </view>
  </view>

  <!-- ç­›é€‰æ ‡ç­¾ -->
  <view class="filter-tabs">
    <view class="filter-tab {{filterType === 'all' ? 'active' : ''}}" bindtap="onFilterChange" data-type="all">
      å…¨éƒ¨
    </view>
    <view class="filter-tab {{filterType === 'expired' ? 'active' : ''}}" bindtap="onFilterChange" data-type="expired">
      å·²è¿‡æœŸ
    </view>
    <view class="filter-tab {{filterType === 'warning' ? 'active' : ''}}" bindtap="onFilterChange" data-type="warning">
      å³å°†è¿‡æœŸ
    </view>
    <view class="filter-tab {{filterType === 'normal' ? 'active' : ''}}" bindtap="onFilterChange" data-type="normal">
      æ­£å¸¸
    </view>
  </view>

  <!-- ç‰©å“åˆ—è¡¨ -->
  <view class="item-list" wx:if="{{!isEmpty}}">
    <view 
      class="item-card" 
      wx:for="{{items}}" 
      wx:key="_id"
      catchtap="editItem"
      data-id="{{item.id}}"
    >
      <!-- å·¦ä¾§å•†å“å›¾ç‰‡ -->
      <view class="item-image-wrapper">
        <image 
          class="item-image" 
          src="{{item.productImage}}" 
          mode="aspectFill"
          wx:if="{{item.productImage}}"
        />
        <view class="item-image-placeholder" wx:else>
          <text class="placeholder-icon">ğŸ“¦</text>
        </view>
      </view>
      
      <!-- ä¸­é—´å†…å®¹åŒº -->
      <view class="item-content">
        <view class="item-name-wrapper">
          <text class="item-name">{{item.name}}</text>
          <view class="item-quantity-inline" wx:if="{{item.quantity && item.quantity > 1}}">
            Ã—{{item.quantity}}
          </view>
        </view>
        <view class="item-meta">
          <view class="item-category-inline" wx:if="{{item.category}}">
            {{item.category}}
          </view>
          <view class="item-date-inline">
            <text class="date-icon-small">ğŸ“…</text>
            <text>{{item.expireDisplay || item.expireDate || 'æ— æ—¥æœŸ'}}</text>
          </view>
        </view>
      </view>
      
      <!-- å³ä¾§çŠ¶æ€åŒº -->
      <view class="item-right">
        <view class="days-remaining" style="color: {{item.statusColor}};">
          <text wx:if="{{item.daysRemaining < 0}}">å·²è¿‡æœŸ</text>
          <text wx:elif="{{item.daysRemaining === 0}}">ä»Šå¤©</text>
          <text wx:else>{{item.daysRemaining}}å¤©</text>
        </view>
        <view class="status-tag-compact" style="background-color: {{item.statusBgColor}}; color: {{item.statusColor}};">
          {{item.statusText}}
        </view>
        <view class="push-tag-compact">
          {{item.pushStatus || 'æœªæ¨é€'}}
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{isEmpty}}">
    <text class="empty-icon">ğŸ“­</text>
    <text class="empty-text">æš‚æ— ç‰©å“è®°å½•</text>
    <text class="empty-hint">ç‚¹å‡»åº•éƒ¨"æ·»åŠ "æŒ‰é’®æ·»åŠ ç¬¬ä¸€ä¸ªç‰©å“</text>
  </view>

</view>

<!-- ç¼–è¾‘æ¨¡æ€æ¡† -->
<view class="edit-modal" wx:if="{{showEditModal}}">
  <view class="modal-mask" catchtap="closeEditModal"></view>
  <view class="modal-content">
    <!-- æ ‡é¢˜æ  -->
    <view class="modal-header">
      <text class="modal-title">ç¼–è¾‘ç‰©å“</text>
      <text class="modal-close" catchtap="closeEditModal">âœ•</text>
    </view>
    
    <!-- è¡¨å•å†…å®¹ -->
    <scroll-view class="modal-body" scroll-y>
      <!-- å•†å“å›¾ç‰‡ -->
      <view class="form-item">
        <view class="form-label">å•†å“å›¾ç‰‡</view>
        <view class="modal-image-upload">
          <view class="modal-image-preview" wx:if="{{editForm.productImage}}" catchtap="previewModalImage">
            <image class="modal-uploaded-image" src="{{editForm.productImage}}" mode="aspectFill"/>
            <view class="modal-image-remove" catchtap="removeModalImage">Ã—</view>
          </view>
          <view class="modal-upload-btn" wx:else catchtap="uploadModalImage">
            <text class="modal-upload-icon">ğŸ“·</text>
            <text class="modal-upload-text">ä¸Šä¼ å›¾ç‰‡</text>
          </view>
        </view>
      </view>

      <!-- ç‰©å“åç§° -->
      <view class="form-item">
        <view class="form-label"><text class="required">*</text>ç‰©å“åç§°</view>
        <input class="form-input" placeholder="è¯·è¾“å…¥ç‰©å“åç§°" value="{{editForm.name}}" bindinput="onEditNameInput" maxlength="30" />
      </view>

      <!-- æ ‡ç­¾ -->
      <view class="form-item">
        <view class="form-label">æ ‡ç­¾</view>
        <input class="form-input" placeholder="è¯·è¾“å…¥æˆ–é€‰æ‹©æ ‡ç­¾" value="{{editForm.category}}" bindinput="onEditCategoryInput" maxlength="10" />
        <view class="category-tags">
          <text class="category-tag {{editForm.category === item ? 'active' : ''}}" wx:for="{{categories}}" wx:key="*this" data-category="{{item}}" catchtap="selectEditCategory">
            {{item}}
          </text>
        </view>
      </view>

      <!-- ä»¶æ•° -->
      <view class="form-item">
        <view class="form-label">ä»¶æ•°</view>
        <view class="quantity-control">
          <view class="quantity-btn" catchtap="adjustEditQuantity" data-action="minus">ï¼</view>
          <input class="quantity-input" type="number" value="{{editForm.quantity}}" bindinput="onEditQuantityInput" />
          <text class="quantity-unit">ä»¶</text>
          <view class="quantity-btn" catchtap="adjustEditQuantity" data-action="plus">ï¼‹</view>
        </view>
      </view>

      <!-- è¿‡æœŸæ—¥æœŸ -->
      <view class="form-item">
        <view class="form-label"><text class="required">*</text>è¿‡æœŸæ—¥æœŸ</view>
        <picker mode="date" value="{{editForm.expireDate}}" bindchange="onEditDateChange">
          <view class="form-picker">
            <text>{{editForm.expireDate || 'è¯·é€‰æ‹©è¿‡æœŸæ—¥æœŸ'}}</text>
            <text class="picker-arrow">â€º</text>
          </view>
        </picker>
      </view>

      <!-- å¤‡æ³¨ -->
      <view class="form-item">
        <view class="form-label">å¤‡æ³¨</view>
        <textarea class="form-textarea" placeholder="æ·»åŠ å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰" value="{{editForm.note}}" bindinput="onEditNoteInput" maxlength="100" />
      </view>
    </scroll-view>

    <!-- åº•éƒ¨æŒ‰é’® -->
    <view class="modal-footer">
      <view class="modal-btn modal-btn-delete" catchtap="deleteFromModal">åˆ é™¤</view>
      <view class="modal-btn modal-btn-save" catchtap="saveEdit">ä¿å­˜</view>
    </view>
  </view>
</view>
