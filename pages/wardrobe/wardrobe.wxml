<!-- pages/wardrobe/wardrobe.wxml -->
<view class="wardrobe-container">
  <!-- 统计卡片区域 -->
  <view class="stats-header">
    <view class="stats-grid">
      <view class="stat-item" wx:for="{{categories}}" wx:key="id" 
            bindtap="goToCategoryItems" data-id="{{item.id}}" data-name="{{item.name}}">
        <view class="stat-number">{{item.count}}</view>
        <view class="stat-label">{{item.name}}</view>
      </view>
    </view>
  </view>

  <!-- 操作按钮区域 -->
  <view class="action-buttons">
    <button class="action-btn add-item" bindtap="showAddItem">
      <text class="btn-icon">👔</text>
      <text>添加衣服</text>
    </button>
    
    <button class="action-btn primary" bindtap="showAddCategory">
      <text class="btn-icon">+</text>
      <text>添加标签</text>
    </button>
    
    <button class="action-btn secondary" bindtap="goToOutfit">
      <text class="btn-icon">👗</text>
      <text>虚拟试衣</text>
    </button>
  </view>

  <!-- 提示文本 -->
  <view class="tip-text" wx:if="{{categories.length === 0}}">
    <text>还没有衣服分类，点击"添加标签"开始吧～</text>
  </view>
</view>

<!-- 添加分类弹窗 -->
<view class="modal-mask" wx:if="{{showCategoryDialog}}" bindtap="closeCategoryDialog">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">添加标签</text>
      <text class="modal-close" bindtap="closeCategoryDialog">✕</text>
    </view>
    
    <view class="modal-body">
      <input 
        class="category-input"
        placeholder="请输入标签名称（如：T恤、外套等）"
        value="{{newCategoryName}}"
        bindinput="onCategoryNameInput"
        focus="{{showCategoryDialog}}"
        maxlength="20"
      />
    </view>
    
    <view class="modal-footer">
      <button class="modal-btn cancel" bindtap="closeCategoryDialog">取消</button>
      <button class="modal-btn confirm" bindtap="createCategory">确定</button>
    </view>
  </view>
</view>

<!-- 添加衣服弹窗 -->
<view class="modal-mask" wx:if="{{showAddItemDialog}}" bindtap="closeAddItemDialog">
  <view class="modal-content large" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">添加衣服</text>
      <text class="modal-close" bindtap="closeAddItemDialog">✕</text>
    </view>
    
    <scroll-view class="modal-body" scroll-y>
      <!-- 选择标签 -->
      <view class="form-item">
        <text class="label">选择标签<text class="required">*</text></text>
        <picker mode="selector" range="{{categories}}" range-key="name" value="{{selectedCategoryIndex}}" bindchange="onCategoryChange">
          <view class="picker-view">
            {{categories[selectedCategoryIndex].name || '请选择'}}
          </view>
        </picker>
      </view>

      <!-- 上传图片 -->
      <view class="form-item">
        <text class="label">衣服图片<text class="required">*</text></text>
        <view class="upload-area" wx:if="{{!itemForm.imageUrl}}" bindtap="chooseItemImage">
          <text class="upload-icon">📷</text>
          <text class="upload-text">点击上传衣服照片</text>
        </view>
        <view class="image-preview" wx:else bindtap="previewItemImage">
          <image src="{{itemForm.imageUrl}}" mode="aspectFill" />
          <text class="remove-image" catchtap="removeItemImage">✕</text>
        </view>
      </view>

      <!-- 衣服名称 -->
      <view class="form-item">
        <text class="label">衣服名称<text class="required">*</text></text>
        <input 
          class="input" 
          placeholder="如：白色T恤、牛仔裤" 
          value="{{itemForm.name}}" 
          bindinput="onItemNameInput"
          maxlength="50"
        />
      </view>
    </scroll-view>
    
    <view class="modal-footer">
      <button class="modal-btn cancel" bindtap="closeAddItemDialog">取消</button>
      <button class="modal-btn confirm" bindtap="saveItem">保存</button>
    </view>
  </view>
</view>
